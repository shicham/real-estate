# GitHub Actions CI Workflow for Real Estate Project
# This workflow builds and tests the TypeScript-based monorepo

name: CI

# Trigger this workflow on push and pull request events to the main branch
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-and-test:
    # Run on the latest Ubuntu runner
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Set up Node.js environment
      # Using Node.js 18.x for compatibility with the project dependencies
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      # Step 3: Install dependencies
      # This installs dependencies for all workspace packages in the monorepo
      - name: Install dependencies
        run: npm ci

      # Step 4: Build all TypeScript projects
      # Build backend services (api-auth, api-property, api-usermng)
      - name: Build backend services
        run: |
          cd backend/api-auth && npm run build
          cd ../api-property && npm run build
          cd ../api-usermng && npm run build

      # Build frontend applications (site, admin, agency)
      - name: Build frontend applications
        run: |
          cd frontend/site && npm run build
          cd ../admin && npm run build
          cd ../agency && npm run build

      # Step 5: Run tests
      # Note: Currently no test scripts are defined in the project
      # This is a placeholder for when tests are added in the future
      - name: Run tests
        run: |
          echo "No test scripts defined yet. Add 'npm test' commands when tests are available."
          # Uncomment the following lines when test scripts are added:
          # cd backend/api-auth && npm test
          # cd backend/api-property && npm test
          # cd backend/api-usermng && npm test
